<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Transcription and Summarization</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Upload Audio for Summary</h1>
    <form id="upload-form">
        <label for="audio-file">Select an audio file:</label>
        <input type="file" id="audio-file" name="audio" accept="audio/*" required>
        
        <!-- NEW: Language Selection Dropdown -->
        <label for="language">Select Language:</label>
        <select id="language" name="language">
            <option value="auto">Auto-Detect</option>
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
            <option value="pt">Portuguese</option>
            <!-- Add more languages as needed -->
        </select>
        
        <button type="submit">Upload and Process</button>
    </form>

    <div id="loader" class="loader" style="display: none;"></div>

    <div id="results" style="display: none;">
        <h2>Summary</h2>
        <div id="summary"></div>
        <h2>Full Transcription</h2>
        <div id="transcription"></div>
    </div>

    <script>
        document.getElementById('upload-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const fileInput = document.getElementById('audio-file');
            const audioFile = fileInput.files[0];

            // NEW: Get the selected language value
            const languageSelect = document.getElementById('language');
            const selectedLanguage = languageSelect.value;

            if (!audioFile) {
                alert('Please select an audio file.');
                return;
            }

            const formData = new FormData();
            formData.append('audio', audioFile);
            // NEW: Append the selected language to the form data
            formData.append('language', selectedLanguage);

            const loader = document.getElementById('loader');
            const resultsDiv = document.getElementById('results');
            loader.style.display = 'block';
            resultsDiv.style.display = 'none';

            try {
                const response = await fetch('/upload-audio', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'An unknown error occurred.');
                }

                const data = await response.json();
                document.getElementById('summary').innerText = data.summary;
                document.getElementById('transcription').innerText = data.transcription;
                resultsDiv.style.display = 'block';

            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                loader.style.display = 'none';
            }
        });
    </script>
</body>
</html>